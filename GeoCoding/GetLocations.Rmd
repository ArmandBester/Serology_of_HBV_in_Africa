---
title: "Get places from spreadsheet"
author: "Armand"
date: "22 September 2018"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

<br>

#### On behalve of the authors of the work:



### Application of sero-epidemiology data to informing interventions for HBV in Africa: should diagnosis and treatment replace catch-up vaccination?

<br>

This is to prepare the locations for the jupyter notebook, GeocodeNotebook.ipynb

<br>

#### load some libraries

```{r libs}
library(readxl)
library(dplyr)
library(stringr)
```





#### Import the data
```{r data}

df <- read_xlsx("../180907 Metadata for Prisma analysis REVIEWED.xlsx", range = "A1:G121")

```


#### Remove NAs and select only needed columns

```{r clean}
places.df <- df %>%
  filter(!is.na(df$Citation)) %>% # remove NA using Citation
  select(c(1,7)) %>%              # keep only country and City
  mutate(CountryCity = paste0(Country, ", ", 
                              `City / location (for GPS)`)) %>%  # concatenate coutry and city
  mutate(Place = CountryCity)  # copy the CountryCity variable over to a new variable Place
  
```

#### Eplore places
<br>

For the purpose of geocoding, atributes like rural vs urban does not provide additional information.  When nationa wide, the country is implied, as well with NK (not known)

<br>

```{r}

table(places.df$Place)


```

```{r cleanLocs}

# Remove and replace
tmp.places.df <- places.df %>% 
  mutate(Place = gsub('\\(', '', Place)) %>% 
  mutate(Place = gsub('\\)', '', Place)) %>% 
  mutate(Place = gsub('rural', '', Place)) %>% 
  mutate(Place = gsub('urban', '', Place)) %>% 
  mutate(Place = gsub(' Health Area of the Djoungolo Health District', '', Place)) %>% 
  mutate(Place = gsub(', multiple sites', '', Place)) %>% 
  mutate(Place = gsub(' multiple sites', '', Place)) %>% 
  mutate(Place = gsub(' &', '', Place)) %>% 
  mutate(Place = gsub(', Multiple  sites', '', Place)) %>% 
  mutate(Place = gsub(', Multiple sites', '', Place)) %>% 
  mutate(Place = gsub('Cameroon, Yaounde', 'Cameroon, Yaoundé', Place)) %>% 
  mutate(Place = gsub(', Nationwide', '', Place)) %>% 
  mutate(Place = gsub("Cote d'Ivoire, Valley of Bandarna- Bouake", 
                      "Cote d'Ivoire, Valley of Bandarna-Bouake", Place)) %>% 
  mutate(Place = gsub("Egypt, Tanta City, Egypt", 
                      "Egypt, Tanta City", Place)) %>% 
   mutate(Place = gsub("Nigeria, Ibadan, southwestern Nigeria", "Nigeria, Ibadan", Place)) %>% 
   mutate(Place = gsub("Nigeria, NA", "Nigeria", Place)) %>% 
  mutate(Place = gsub(", NA", "", Place)) %>% 
  mutate(Place = gsub("South Africa, Medunsa Campus; large hospital 31 km north–west of Pretoria",
                      "South Africa, Medunsa Campus", Place)) %>% 
  mutate(Place = gsub(", Mulitple regions", "", Place)) %>% 
  mutate(Place = gsub("^\\s+|\\s+$", "", Place))


 
places.df <- tmp.places.df
rm(tmp.places.df)

write.csv(unique(places.df$Place), "uniquePlaces.csv")

write.csv(places.df, "places.csv")  

table(places.df$Place)
```


































